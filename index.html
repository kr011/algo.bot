<!DOCTYPE html>
<html>

<head>
<title>algo.bot</title>
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" sizes="192x192" href="/favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<style>
    body {
        background-color: black;
        font-family: monospace;
        font-size: large;
        color: beige;
        margin: 0;
    }

    a {
        color: #00C0FF;
    }

    .event_table {
        border-collapse:collapse;
    }

    .contact {
        float: right;
        white-space: nowrap;
        width: 132px;
    }

    .contact_icon {
        float: left;
        padding-right: 5px;
    }

    .contact_email {
        padding-left: 8px;
        line-height: 21px;
    }

    footer {
        padding-top: 5px;
        margin-top: 5px;
        border-top: solid;
        border-top-width: thin;
        bottom: 0;
        width: 100%;
    }
</style>
</head>

<body>
<script>
fetch('https://s3.amazonaws.com/algo.bot/crypto/2021.json')
.then(function(u){ return u.json();})
.then(function(jsonArr){
    let chartData = [];
    let tableData = [];
    pnlTotal = 0;
    for (var i = 0, len = jsonArr.length; i < len; i++)
    {
        rawObj = JSON.parse(jsonArr[i]);
        // chart data
        pnlTotal += rawObj.pnl
        obj = {'time': rawObj.timestamp, 'value': pnlTotal};
        chartData.push(obj);
        // table data
        tableData.push([(new Date(rawObj.timestamp * 1000)).toLocaleString('en-US', { hour12: false }), "$" + rawObj.pnl]);
    }

    GenerateChart('crypto-chart', chartData);
    GenerateTable('crypto-table', tableData);
});

function GenerateChart(chartId, chartData) {
    var chartElement = document.getElementById(chartId);
    const chart = LightweightCharts.createChart(
        chartElement,
        { width: document.body.offsetWidth, height: 300 });
    chart.applyOptions({
        layout: {
            backgroundColor: '#000',
            lineColor: '#2B2B43',
            textColor: '#D9D9D9',
        },
        watermark: {
            color: 'rgba(0, 0, 0, 0)',
        },
        crosshair: {
            color: '#758696',
        },
        grid: {
            vertLines: {
                color: '#2B2B43',
            },
            horzLines: {
                color: '#363C4E',
            },
        }
    });

    const lineSeries = chart.addLineSeries();
    lineSeries.setData(chartData);
}

function GenerateTable(tableId, tableData) {
    // create a HTML table element
    var table = document.createElement("TABLE");
    table.border = "1";
    table.width = "100%";
    table.setAttribute('class', 'event_table');

    // get the count of columns.
    var columnCount = tableData[0].length;

    // add the header row
    header = ["TIMESTAMP", "P/L"]
    var row = table.insertRow(-1);
    for (var i = 0; i < columnCount; i++) {
        var headerCell = document.createElement("TH");
        headerCell.innerHTML = header[i];
        row.appendChild(headerCell);
    }

    // add the data rows in reverse
    // let maxRowCount = tableData.length;
    let maxRowCount = 10;
    let rowCount = tableData.length - maxRowCount;
    if (rowCount < 0) {rowCount = 0;}
    for (var i = tableData.length-1; i >= rowCount; i--) {
        row = table.insertRow(-1);
        for (var j = 0; j < columnCount; j++) {
            var cell = row.insertCell(-1);
            cell.innerHTML = tableData[i][j];
        }
    }

    var dvTable = document.getElementById(tableId);
    dvTable.innerHTML = "";
    dvTable.appendChild(table);
}
</script>
<div id='crypto'>
<div id='crypto-chart'></div>
<div id='crypto-table'></div>
</div>

<footer>
<div class="contact">
<div class="contact_icon">&#9993;</div>
<div class="contact_email">
    <a href="mailto:kr@algo.bot">kr@algo.bot</a>
</div>
</div>
</footer>
</body>

</html>